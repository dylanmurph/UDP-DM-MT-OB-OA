<!DOCTYPE html>
<html>
<head>
    <title>Hardware Test</title>
</head>
<body>
    <h1>HostLock Hardware</h1>

    <div>UID: <span id="uid">Waiting...</span></div>
    <div>Status: <span id="status">Waiting...</span></div>
    <div>
        <img id="preview" src="" />
    </div>

    <script>
        const evt = new EventSource("/stream");

        evt.onmessage = function (event) {
            const data = JSON.parse(event.data);

            if (data.nfc_uid) {
                document.getElementById("uid").innerText = data.nfc_uid;
                document.getElementById("status").innerText = "Processing...";
            }

            if (data.access) {
                document.getElementById("status").innerText =
                    data.access === "granted" ? "ACCESS GRANTED" : "ACCESS DENIED";
            }

            if (data.image_filename) {
                const img = document.getElementById("preview");
                img.src = "/image/" + data.image_filename + "?t=" + Date.now();
            }
        };
    </script>
</body>
</html>
